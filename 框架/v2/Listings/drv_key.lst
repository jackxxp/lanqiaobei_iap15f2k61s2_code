C51 COMPILER V9.60.7.0   DRV_KEY                                                           02/03/2026 16:52:08 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DRV_KEY
OBJECT MODULE PLACED IN .\Objects\drv_key.obj
COMPILER INVOKED BY: C:\Program Files (x86)\keil\C51\BIN\C51.EXE drv_key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\Listings\drv_key.lst) TABS(2) OBJECT(.\Objects\drv_key.obj)

line level    source

   1          //drv_key.c
   2          #include "drv_key.h"
   3          
   4          static uint8 key_ram = 200;
   5          
   6          void drv_key_run()
   7          {
   8   1          static uint8 key_step = 0;
   9   1          static uint8 key_ptime = 0;
  10   1          static uint8 saved_key = 0; // ğŸ‘ˆ æ–°å¢ï¼šä¿å­˜åŸå§‹é”®å€¼ï¼ˆ4ï½19ï¼‰
  11   1      
  12   1          uint8 key_now = 0xFF;
  13   1          uint8 key_temp = 201; // é»˜è®¤æ— æ•ˆ
  14   1      
  15   1          // è¡Œæ‰«æï¼šæ‹‰ä½æ‰€æœ‰è¡Œ
  16   1          P3 = 0x0F;
  17   1          P42 = 0;
  18   1          P44 = 0;
  19   1          P36 = P42;
  20   1          P37 = P44;
  21   1          key_now = P3 & 0x0F;
  22   1      
  23   1          switch(key_step)
  24   1          {
  25   2              case 0: // ç©ºé—²æ€
  26   2                  if (key_now != 0x0F) {
  27   3                      key_step = 1;
  28   3                  }
  29   2                  break;
  30   2      
  31   2              case 1: // æ£€æµ‹åˆ°æœ‰é”®æŒ‰ä¸‹ï¼Œå¼€å§‹åˆ—æ‰«æ
  32   2                  if (key_now == 0x0F) {
  33   3                      key_step = 0; // æŠ–åŠ¨ï¼Œå›åˆ°ç©ºé—²
  34   3                  } else {
  35   3                      // åˆ‡æ¢åˆ°åˆ—è¾“å‡ºæ¨¡å¼
  36   3                      P3 = key_now | 0xF0;
  37   3                      P42 = 1;
  38   3                      P44 = 1;
  39   3                      P36 = P42;
  40   3                      P37 = P44;
  41   3                      key_now = P3; // è¯»å–å®Œæ•´é”®å€¼
  42   3      
  43   3                      // è¯†åˆ«é”®å€¼
  44   3                      switch (key_now) 
  45   3                      {
  46   4                        case 0xF7: saved_key = 4; break;   //ç‹¬ç«‹æŒ‰é”®   åªç”¨ç‹¬ç«‹æŒ‰é”®çŸ©é˜µæŒ‰é”®éƒ¨åˆ†å¯ä¸å†™
  47   4                        case 0xFB: saved_key = 5; break;   //ç‹¬ç«‹æŒ‰é”®     åªç”¨çŸ©é˜µé”®ç›˜ç‹¬ç«‹é”®ç›˜å¯ä¸
  48   4                          case 0xFD: saved_key = 6; break;   //ç‹¬ç«‹æŒ‰é”®   å¦‚æœéƒ½å†™åˆ™éƒ½å¯ä»¥ä½¿ç”¨
  49   4                          case 0xFE: saved_key = 7; break;   //ç‹¬ç«‹æŒ‰é”®
  50   4                        
  51   4                          case 0x77: saved_key = 4; break;   //çŸ©é˜µæŒ‰é”®
  52   4                          case 0x7B: saved_key = 5; break;   //çŸ©é˜µæŒ‰é”®
  53   4                          case 0x7D: saved_key = 6; break;//çŸ©é˜µæŒ‰é”®
  54   4                          case 0x7E: saved_key = 7; break;//çŸ©é˜µæŒ‰é”®
C51 COMPILER V9.60.7.0   DRV_KEY                                                           02/03/2026 16:52:08 PAGE 2   

  55   4      
  56   4                          case 0xB7: saved_key = 8; break;//çŸ©é˜µæŒ‰é”®
  57   4                          case 0xBB: saved_key = 9; break;//çŸ©é˜µæŒ‰é”®
  58   4                          case 0xBD: saved_key = 10; break;//çŸ©é˜µæŒ‰é”®
  59   4                          case 0xBE: saved_key = 11; break;//çŸ©é˜µæŒ‰é”®
  60   4      
  61   4                          case 0xD7: saved_key = 12; break;//çŸ©é˜µæŒ‰é”®
  62   4                          case 0xDB: saved_key = 13; break;//çŸ©é˜µæŒ‰é”®
  63   4                          case 0xDD: saved_key = 14; break;//çŸ©é˜µæŒ‰é”®
  64   4                          case 0xDE: saved_key = 15; break;//çŸ©é˜µæŒ‰é”®
  65   4      
  66   4                          case 0xE7: saved_key = 16; break;//çŸ©é˜µæŒ‰é”®
  67   4                          case 0xEB: saved_key = 17; break;//çŸ©é˜µæŒ‰é”®
  68   4                          case 0xED: saved_key = 18; break;//çŸ©é˜µæŒ‰é”®
  69   4                          case 0xEE: saved_key = 19; break;//çŸ©é˜µæŒ‰é”®
  70   4                          default:
  71   4                              key_step = 0;
  72   4                              saved_key = 201;
  73   4                              return; // é€€å‡ºï¼Œä¸æ›´æ–° key_ram
  74   4                      }
  75   3                      key_step = 2;
  76   3                  }
  77   2                  break;
  78   2      
  79   2              case 2: // ç­‰å¾…é‡Šæ”¾ï¼ˆçŸ­æŒ‰ï¼‰æˆ–è¿›å…¥é•¿æŒ‰
  80   2                  // é‡æ–°è¯»å–è¡ŒçŠ¶æ€
  81   2                  P3 = 0x0F;
  82   2                  P42 = 0;
  83   2                  P44 = 0;
  84   2                  P36 = P42;
  85   2                  P37 = P44;
  86   2                  key_now = P3 & 0x0F;
  87   2      
  88   2                  if (key_now != 0x0F) {
  89   3                      // æŒ‰é”®ä»æŒ‰ä¸‹ï¼Œè®¡æ—¶
  90   3                      key_ptime++;
  91   3                      if (key_ptime > 70) { // é•¿æŒ‰é˜ˆå€¼
  92   4                          key_ptime = 0;
  93   4                          key_step = 3;
  94   4                          // æ³¨æ„ï¼šé•¿æŒ‰ç»“æœåœ¨æ¾æ‰‹æ—¶æ‰ä¸ŠæŠ¥
  95   4                      }
  96   3                  } else {
  97   3                      // çŸ­æŒ‰ï¼šæ¾æ‰‹äº†
  98   3                      key_ptime = 0;
  99   3                      key_step = 0;
 100   3                      key_temp = saved_key; // ğŸ‘ˆ ä½¿ç”¨ä¿å­˜çš„é”®å€¼
 101   3                  }
 102   2                  break;
 103   2      
 104   2              case 3: // é•¿æŒ‰ç­‰å¾…æ¾æ‰‹
 105   2                  P3 = 0x0F;
 106   2                  P42 = 0;
 107   2                  P44 = 0;
 108   2                  P36 = P42;
 109   2                  P37 = P44;
 110   2                  key_now = P3 & 0x0F;
 111   2      
 112   2                  if (key_now == 0x0F) {
 113   3                      // æ¾æ‰‹ï¼Œä¸ŠæŠ¥é•¿æŒ‰
 114   3                      key_step = 0;
 115   3                      key_temp = saved_key + 100; // ğŸ‘ˆ æ­£ç¡®ï¼šåŸå§‹é”®å€¼+100
 116   3                  }
C51 COMPILER V9.60.7.0   DRV_KEY                                                           02/03/2026 16:52:08 PAGE 3   

 117   2                  break;
 118   2          }
 119   1          if (key_temp != 201)
 120   1          {key_ram = key_temp;}
 121   1      }
 122          
 123          uint8 drv_key_get()
 124          {
 125   1          uint8 temp = key_ram;
 126   1          key_ram = 201; // æ¸…é™¤ï¼Œé¿å…é‡å¤ä¸ŠæŠ¥
 127   1          return temp;
 128   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    366    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
