C51 COMPILER V9.60.7.0   DRV_KEY                                                           01/30/2026 00:23:36 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DRV_KEY
OBJECT MODULE PLACED IN .\Objects\drv_key.obj
COMPILER INVOKED BY: C:\Program Files (x86)\keil\C51\BIN\C51.EXE drv_key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\Listings\drv_key.lst) TABS(2) OBJECT(.\Objects\drv_key.obj)

line level    source

   1          #include "drv_key.h"
   2          
   3          static uint8 key_ram = 200;
   4          
   5          void drv_key_run()
   6          {
   7   1          static uint8 key_step = 0;
   8   1          static uint8 key_ptime = 0;
   9   1          static uint8 saved_key = 0; // ğŸ‘ˆ æ–°å¢ï¼šä¿å­˜åŸå§‹é”®å€¼ï¼ˆ4ï½19ï¼‰
  10   1      
  11   1          uint8 key_now = 0xFF;
  12   1          uint8 key_temp = 201; // é»˜è®¤æ— æ•ˆ
  13   1      
  14   1          // è¡Œæ‰«æï¼šæ‹‰ä½æ‰€æœ‰è¡Œ
  15   1          P3 = 0x0F;
  16   1          P42 = 0;
  17   1          P44 = 0;
  18   1          P36 = P42;
  19   1          P37 = P44;
  20   1          key_now = P3 & 0x0F;
  21   1      
  22   1          switch(key_step)
  23   1          {
  24   2              case 0: // ç©ºé—²æ€
  25   2                  if (key_now != 0x0F) {
  26   3                      key_step = 1;
  27   3                  }
  28   2                  break;
  29   2      
  30   2              case 1: // æ£€æµ‹åˆ°æœ‰é”®æŒ‰ä¸‹ï¼Œå¼€å§‹åˆ—æ‰«æ
  31   2                  if (key_now == 0x0F) {
  32   3                      key_step = 0; // æŠ–åŠ¨ï¼Œå›åˆ°ç©ºé—²
  33   3                  } else {
  34   3                      // åˆ‡æ¢åˆ°åˆ—è¾“å‡ºæ¨¡å¼
  35   3                      P3 = key_now | 0xF0;
  36   3                      P42 = 1;
  37   3                      P44 = 1;
  38   3                      P36 = P42;
  39   3                      P37 = P44;
  40   3                      key_now = P3; // è¯»å–å®Œæ•´é”®å€¼
  41   3      
  42   3                      // è¯†åˆ«é”®å€¼
  43   3                      switch (key_now) 
  44   3                      {
  45   4                        case 0xF7: saved_key = 4; break;   //ç‹¬ç«‹æŒ‰é”®   åªç”¨ç‹¬ç«‹æŒ‰é”®çŸ©é˜µæŒ‰é”®éƒ¨åˆ†å¯ä¸å†™
  46   4                        case 0xFB: saved_key = 5; break;   //ç‹¬ç«‹æŒ‰é”®     åªç”¨çŸ©é˜µé”®ç›˜ç‹¬ç«‹é”®ç›˜å¯ä¸
  47   4                          case 0xFD: saved_key = 6; break;   //ç‹¬ç«‹æŒ‰é”®   å¦‚æœéƒ½å†™åˆ™éƒ½å¯ä»¥ä½¿ç”¨
  48   4                          case 0xFE: saved_key = 7; break;   //ç‹¬ç«‹æŒ‰é”®
  49   4                        
  50   4                          case 0x77: saved_key = 4; break;   //çŸ©é˜µæŒ‰é”®
  51   4                          case 0x7B: saved_key = 5; break;   //çŸ©é˜µæŒ‰é”®
  52   4                          case 0x7D: saved_key = 6; break;//çŸ©é˜µæŒ‰é”®
  53   4                          case 0x7E: saved_key = 7; break;//çŸ©é˜µæŒ‰é”®
  54   4      
C51 COMPILER V9.60.7.0   DRV_KEY                                                           01/30/2026 00:23:36 PAGE 2   

  55   4                          case 0xB7: saved_key = 8; break;//çŸ©é˜µæŒ‰é”®
  56   4                          case 0xBB: saved_key = 9; break;//çŸ©é˜µæŒ‰é”®
  57   4                          case 0xBD: saved_key = 10; break;//çŸ©é˜µæŒ‰é”®
  58   4                          case 0xBE: saved_key = 11; break;//çŸ©é˜µæŒ‰é”®
  59   4      
  60   4                          case 0xD7: saved_key = 12; break;//çŸ©é˜µæŒ‰é”®
  61   4                          case 0xDB: saved_key = 13; break;//çŸ©é˜µæŒ‰é”®
  62   4                          case 0xDD: saved_key = 14; break;//çŸ©é˜µæŒ‰é”®
  63   4                          case 0xDE: saved_key = 15; break;//çŸ©é˜µæŒ‰é”®
  64   4      
  65   4                          case 0xE7: saved_key = 16; break;//çŸ©é˜µæŒ‰é”®
  66   4                          case 0xEB: saved_key = 17; break;//çŸ©é˜µæŒ‰é”®
  67   4                          case 0xED: saved_key = 18; break;//çŸ©é˜µæŒ‰é”®
  68   4                          case 0xEE: saved_key = 19; break;//çŸ©é˜µæŒ‰é”®
  69   4                          default:
  70   4                              key_step = 0;
  71   4                              saved_key = 201;
  72   4                              return; // é€€å‡ºï¼Œä¸æ›´æ–° key_ram
  73   4                      }
  74   3                      key_step = 2;
  75   3                  }
  76   2                  break;
  77   2      
  78   2              case 2: // ç­‰å¾…é‡Šæ”¾ï¼ˆçŸ­æŒ‰ï¼‰æˆ–è¿›å…¥é•¿æŒ‰
  79   2                  // é‡æ–°è¯»å–è¡ŒçŠ¶æ€
  80   2                  P3 = 0x0F;
  81   2                  P42 = 0;
  82   2                  P44 = 0;
  83   2                  P36 = P42;
  84   2                  P37 = P44;
  85   2                  key_now = P3 & 0x0F;
  86   2      
  87   2                  if (key_now != 0x0F) {
  88   3                      // æŒ‰é”®ä»æŒ‰ä¸‹ï¼Œè®¡æ—¶
  89   3                      key_ptime++;
  90   3                      if (key_ptime > 70) { // é•¿æŒ‰é˜ˆå€¼
  91   4                          key_ptime = 0;
  92   4                          key_step = 3;
  93   4                          // æ³¨æ„ï¼šé•¿æŒ‰ç»“æœåœ¨æ¾æ‰‹æ—¶æ‰ä¸ŠæŠ¥
  94   4                      }
  95   3                  } else {
  96   3                      // çŸ­æŒ‰ï¼šæ¾æ‰‹äº†
  97   3                      key_ptime = 0;
  98   3                      key_step = 0;
  99   3                      key_temp = saved_key; // ğŸ‘ˆ ä½¿ç”¨ä¿å­˜çš„é”®å€¼
 100   3                  }
 101   2                  break;
 102   2      
 103   2              case 3: // é•¿æŒ‰ç­‰å¾…æ¾æ‰‹
 104   2                  P3 = 0x0F;
 105   2                  P42 = 0;
 106   2                  P44 = 0;
 107   2                  P36 = P42;
 108   2                  P37 = P44;
 109   2                  key_now = P3 & 0x0F;
 110   2      
 111   2                  if (key_now == 0x0F) {
 112   3                      // æ¾æ‰‹ï¼Œä¸ŠæŠ¥é•¿æŒ‰
 113   3                      key_step = 0;
 114   3                      key_temp = saved_key + 100; // ğŸ‘ˆ æ­£ç¡®ï¼šåŸå§‹é”®å€¼+100
 115   3                  }
 116   2                  break;
C51 COMPILER V9.60.7.0   DRV_KEY                                                           01/30/2026 00:23:36 PAGE 3   

 117   2          }
 118   1      
 119   1          key_ram = key_temp;
 120   1      }
 121          
 122          uint8 drv_key_get()
 123          {
 124   1          uint8 temp = key_ram;
 125   1          key_ram = 201; // æ¸…é™¤ï¼Œé¿å…é‡å¤ä¸ŠæŠ¥
 126   1          return temp;
 127   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    360    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
